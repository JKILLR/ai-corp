# Molecule Template: Core Engine Feature
# Use this for new features in src/core/

template:
  id: core-feature
  name: "Core Engine Feature"
  description: "Add new functionality to the Core Engine"
  typical_duration: "1-3 days"

  # Variables to fill in when instantiating
  variables:
    - name: feature_name
      description: "Name of the feature being built"
    - name: target_files
      description: "Primary files to create/modify"
    - name: success_criteria
      description: "How we know it's done"

  steps:
    - id: research
      name: "Research & Analysis"
      description: "Understand existing code and design approach"
      department: research
      assigned_to: dir_architecture
      estimated_duration: "2-4 hours"
      outputs:
        - design_document
        - affected_files_list
      gate: null  # No gate, flows to next

    - id: design_review
      name: "Design Review"
      description: "Review and approve the design"
      department: research
      assigned_to: dir_architecture
      depends_on: [research]
      gate: design_review
      gate_approvers:
        - vp_engineering
        - ceo_human  # Phase 2: human approves

    - id: implement
      name: "Implementation"
      description: "Write the code"
      department: engineering
      assigned_to: core_workers
      depends_on: [design_review]
      estimated_duration: "4-8 hours"
      checkpoint_frequency: "per_major_function"
      outputs:
        - source_code
        - unit_tests

    - id: test
      name: "Testing"
      description: "Run tests and verify functionality"
      department: quality
      assigned_to: qa_workers
      depends_on: [implement]
      estimated_duration: "1-2 hours"
      criteria:
        - all_tests_pass: true
        - coverage_maintained: true
        - no_regressions: true
      gate: qa_review

    - id: security_review
      name: "Security Review"
      description: "Check for security issues"
      department: quality
      assigned_to: security_workers
      depends_on: [test]
      estimated_duration: "1-2 hours"
      gate: security_review
      # Only required if touching sensitive areas
      conditional: "touches_auth_or_data"

    - id: documentation
      name: "Documentation"
      description: "Update docs and architecture files"
      department: engineering
      assigned_to: core_workers
      depends_on: [test]
      estimated_duration: "1 hour"
      outputs:
        - updated_docs
        - api_documentation

    - id: release
      name: "Release"
      description: "Merge to main branch"
      department: quality
      assigned_to: vp_quality
      depends_on: [documentation, security_review]
      gate: release_gate
      gate_approvers:
        - vp_quality
        - ceo_human  # Human approval required

  success_contract_template:
    objective: "Implement {{feature_name}} in Core Engine"
    criteria:
      - description: "Feature implemented in {{target_files}}"
        measurable: true
      - description: "Tests written and passing"
        measurable: true
      - description: "Documentation updated"
        measurable: true
      - description: "{{success_criteria}}"
        measurable: true
    in_scope:
      - "Core implementation"
      - "Unit tests"
      - "Integration with existing systems"
    out_of_scope:
      - "UI changes"
      - "External integrations"
